<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miracle Morning Routine</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #C49A93 0%, #B08580 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #333;
        }

        .container {
            background: #F5F1EA;
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            max-width: 700px;
            width: 100%;
            padding: 48px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #2D2D2D;
            font-size: 2.2em;
            margin-bottom: 8px;
            font-weight: 600;
            letter-spacing: -0.5px;
        }

        .day-display {
            font-size: 1em;
            color: #B08580;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .step {
            margin-bottom: 20px;
            padding: 24px;
            background: #FFFFFF;
            border: 1px solid #E5E0D8;
            border-radius: 16px;
            transition: all 0.2s ease;
        }

        .step.completed {
            background: #FAF8F4;
            border-color: #DDD9D0;
        }

        .step.completed .step-title {
            color: #999;
            text-decoration: line-through;
        }

        .step:hover {
            box-shadow: 0 4px 16px rgba(196, 154, 147, 0.1);
            transform: translateY(-2px);
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .step-checkbox {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #C49A93;
            flex-shrink: 0;
        }

        .step-title {
            font-size: 1.15em;
            color: #2D2D2D;
            margin-bottom: 0;
            font-weight: 600;
            flex: 1;
            letter-spacing: -0.3px;
        }

        .step-content {
            line-height: 1.7;
            color: #5A5A5A;
            font-size: 0.95em;
            margin-top: 16px;
            margin-left: 38px;
        }

        .timer-controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .timer-btn {
            background: #C49A93;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            letter-spacing: 0.3px;
            flex: 0;
        }

        .timer-btn:hover {
            background: #B08580;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(196, 154, 147, 0.3);
        }

        .timer-btn:active {
            transform: translateY(0);
        }

        .sound-btn {
            background: #E5E0D8;
            color: #5A5A5A;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .sound-btn:hover {
            background: #C49A93;
            color: white;
        }

        .reflection-sections {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .reflection-section {
            display: flex;
            flex-direction: column;
        }

        .reflection-btn {
            background: #E5E0D8;
            color: #5A5A5A;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            width: 100%;
        }

        .reflection-btn:hover {
            background: #DDD9D0;
            transform: translateY(-1px);
        }

        .reflection-btn.active {
            background: #C49A93;
            color: white;
        }

        .reflection-content {
            margin-top: 12px;
            margin-left: 20px;
        }

        .step-content p {
            margin-bottom: 12px;
        }

        .step-content strong {
            color: #3D3D3D;
            font-weight: 600;
            font-size: 0.9em;
            letter-spacing: 0.5px;
        }

        .reflection-item {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
            font-size: 0.95em;
        }

        .reflection-item:before {
            content: "•";
            position: absolute;
            left: 0;
            color: #C49A93;
            font-weight: bold;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 32px;
            gap: 12px;
        }

        button {
            background: #C49A93;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 0.95em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
            letter-spacing: 0.3px;
        }

        button:hover {
            background: #B08580;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(196, 154, 147, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        @media (max-width: 600px) {
            .container {
                padding: 32px 24px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .step-title {
                font-size: 1.05em;
            }

            .step-content {
                font-size: 0.9em;
                margin-left: 0;
            }

            .timer-btn {
                padding: 4px 8px;
                font-size: 0.7em;
                border-radius: 4px;
            }

            .timer-controls {
                gap: 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Miracle Morning</h1>
            <div class="day-display" id="dayDisplay"></div>
        </div>

        <div id="routine"></div>

        <div class="nav-buttons">
            <button onclick="previousDay()">← Previous Day</button>
            <button onclick="nextDay()">Next Day →</button>
        </div>
    </div>

    <script>
        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        
        const reflections = {
            impermanence: [
                "This body will age, become ill, and die.",
                "Death is certain; The time of death is uncertain.",
                "This moment is part of preparing for death.",
                "There is no guarantee of time remaining.",
                "All beings experience suffering and separation.",
                "Nothing remains fixed; all conditions change moment by moment.",
                "Clinging does not prevent loss or pain.",
                "Relationships, possessions, and roles will change or end."
            ],
            renunciation: [
                "There's no such thing as a person who perfected both Dharma practice and worldly life.",
                "There are no solutions to the suffering of samsara and it cannot be fixed, true happiness cannot be found there.",
                "However positive worldly life may seem, ultimately it will fail.",
                "Until we see samsara as a terminal illness, genuine aspiration to practice cannot arise.",
                "Disgust and revulsion for samsara can be trained; repeated reflection develops genuine renunciation.",
                "Seeking liberation is more important than immediately finding it.",
                "Worldly achievements cannot bring ultimate satisfaction.",
                "Wealth, status, or comfort are unstable, so any attachment to them will lead to suffering.",
                "Recognizing samsara's limitations clarifies the path to freedom.",
                "Spiritual seeking arises naturally when samsara's insufficiency is recognized."
            ],
            emptiness: [
                "Nothing exists independently; all phenomena arise in relation.",
                "There is no fixed self in the flow of mind and body.",
                "Thoughts and sensations appear, change, and dissolve without a controller.",
                "Events arise due to causes and conditions, not by themselves.",
                "The sense of a solid, separate self dissolves when awareness is seen directly.",
                "What we call 'I' is a process of sensing, thinking, and acting, not an independent object.",
                "The boundary between inner and outer experience arises in the mind, not in reality itself.",
                "Subject and object are not two fixed things; they are co‑arising events.",
                "Awareness does not belong to a separate self — it is the field in which everything appears."
            ],
            selfCompassion: [
                "How do I feel right now?",
                "Difficulty arises for me, as it arises for all beings.",
                "May I be free of suffering, anger, irritation, pain, addictions, attachment.",
                "The body and mind experience tension and ease.",
                "All beings, including this one, face impermanence.",
                "Discomfort and struggle are part of the human condition.",
                "No experience needs to be fixed; it is as it is.",
                "May I have all that I wish for myself",
                "May I have all that I need to serve all beings",
                "May everything that happens in my life will help me get closer to Enlightenment"
            ],
            bodhicitta: [
                "All my happiness comes from the kindness of beings.",
                "All beings have been my mothers in past lives.",
                "The purpose of my life is to attain Buddhahood for the benefit of all beings.",
                "I practice not for myself alone, but for the freedom of all beings.",
                "May my actions be guided by care and compassion.",
                "The kindness of others supports every moment of my life.",
                "Compassion arises naturally when we recognize the suffering of beings.",
                "Every being I encounter has shown me some form of care in the past.",
                "May my practice benefit all beings."
            ],
            dedication: [
                "May all beings be free from suffering and its causes.",
                "May all beings find happiness and peace.",
                "May I continue steadily on the path, with clarity and awareness.",
                "May I have the resources and conditions to sustain my practice.",
                "May I have a fulfilling and rewarding job",
                "May my actions benefit others as well as myself.",
                "May my life be a support to others' practice and freedom.",
                "May all beings have the conditions to practice Dharma.",
                "May clarity and insight arise naturally in my mind.",
                "May the seeds of awakening grow in all beings."
            ]
        };

        const visualizations = [
            "<strong>Work:</strong><br>I have a meaningful job, working in mindfulness and giving my full potential in a selfless way. The work nourishes me and I help others.",
            "<strong>Financial:</strong><br>I have enough money to feel calm about it. I have money to donate and give to others. I feel calm when I check my financial situation. I earn enough money to sustain myself.",
            "<strong>Relationships:</strong><br>I have good heart friends that support and help me and I do that for them. I feel friendship with everyone I meet. I feel compassion and love for all beings, including the ones who harm others.",
            "<strong>Practice:</strong><br>I practice everyday in the morning, I keep Bodhichitta in mind, so everything I do during the day is in the means to help me reach full enlightenment for the benefit of others.",
            "<strong>Enlightenment:</strong><br>Imagine light coming from Buddha Shakyamuni filling me with all his qualities of enlightenment: Love, compassion, happiness, wisdom, realization of emptiness, bodhichitta, renunciation, devotion.",
            "<strong>Physical Health:</strong><br>My body is healthy, I have a lot of energy and strength, digestion is working well, my body will live for a long time. I exercise daily.",
            "<strong>Mental Health:</strong><br>I am fulfilled and happy, calm, working for other's benefit, joyful and compassionate."
        ];

        const gratitudes = [
            "<strong>Body:</strong><br>My body, its health, different parts, functions and abilities.",
            "<strong>Family and Friends:</strong><br>My family, friends, coworkers and acquaintances.",
            "<strong>Money:</strong><br>My money, pension, savings, financial support in time of need or emergency.",
            "<strong>Abilities:</strong><br>My abilities, talents, knowledge, education.",
            "<strong>Possessions:</strong><br>Food, electronics, car, clothes, shoes, cosmetics, furniture. Also electricity, water, sun, plants, air.",
            "<strong>Spiritual Path:</strong><br>Meeting the Dharma, practicing, potential of my mind, faith, teachers, dharma centers.",
            "<strong>Past Support by Others:</strong><br>Parents, nannies, teachers, professors, food suppliers, cooks, transportation, medical assistance, government facilities, therapists."
        ];

        let currentDayIndex = new Date().getDay();

        function getReflectionsForDay(dayIndex) {
            const seed = dayIndex;
            const selections = {
                impermanence: [],
                renunciation: [],
                emptiness: [],
                selfCompassion: [],
                bodhicitta: [],
                dedication: []
            };

            // Select 1-2 items from each category based on day
            Object.keys(reflections).forEach((category, catIndex) => {
                const items = reflections[category];
                const count = (dayIndex + catIndex) % 2 === 0 ? 2 : 1;
                
                for (let i = 0; i < count; i++) {
                    const index = (dayIndex * 3 + catIndex * 2 + i) % items.length;
                    selections[category].push(items[index]);
                }
            });

            return selections;
        }

        let timerInterval = null;
        let timeLeft = 0;

        function showCustomTimer() {
            document.getElementById('customTimerInput').style.display = 'block';
        }

        function startCustomTimer() {
            const minutes = parseInt(document.getElementById('customMinutes').value);
            if (minutes && minutes > 0) {
                startTimer(minutes);
            }
        }

        function startTimer(minutes) {
            // Clear any existing timer
            if (timerInterval) {
                clearInterval(timerInterval);
            }

            // Hide custom input, show timer display
            document.getElementById('customTimerInput').style.display = 'none';
            document.getElementById('timerDisplay').style.display = 'block';

            // Set time
            timeLeft = minutes * 60;
            updateTimerDisplay();

            // Start countdown
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    playGong();
                    setTimeout(() => {
                        document.getElementById('timerDisplay').style.display = 'none';
                    }, 3000);
                }
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            document.getElementById('timerDisplay').style.display = 'none';
            document.getElementById('customTimerInput').style.display = 'none';
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timeRemaining').textContent = 
                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function playGong() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            playTibetanBowl(audioContext);
        }

        function toggleReflection(sectionId) {
            const content = document.getElementById(sectionId);
            const button = event.target;
            
            if (content.style.display === 'none' || content.style.display === '') {
                content.style.display = 'block';
                button.classList.add('active');
            } else {
                content.style.display = 'none';
                button.classList.remove('active');
            }
        }

        function playBellGong(audioContext) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = 432;
            oscillator.type = 'sine';

            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 2);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 2);
        }

        function playTibetanBowl(audioContext) {
            const oscillator1 = audioContext.createOscillator();
            const oscillator2 = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator1.connect(gainNode);
            oscillator2.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator1.frequency.value = 256;
            oscillator2.frequency.value = 384;
            oscillator1.type = 'sine';
            oscillator2.type = 'sine';

            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.1);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 4);

            oscillator1.start(audioContext.currentTime);
            oscillator2.start(audioContext.currentTime);
            oscillator1.stop(audioContext.currentTime + 4);
            oscillator2.stop(audioContext.currentTime + 4);
        }

        function playDeepGong(audioContext) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = 110;
            oscillator.type = 'triangle';

            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.4, audioContext.currentTime + 0.05);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 3);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 3);
        }

        function playChime(audioContext) {
            const frequencies = [523.25, 659.25, 783.99]; // C, E, G
            
            frequencies.forEach((freq, index) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = freq;
                oscillator.type = 'sine';

                const startTime = audioContext.currentTime + (index * 0.3);
                gainNode.gain.setValueAtTime(0, startTime);
                gainNode.gain.linearRampToValueAtTime(0.15, startTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 1.5);

                oscillator.start(startTime);
                oscillator.stop(startTime + 1.5);
            });
        }

        function testGongSound(soundType) {
            localStorage.setItem('gongSound', soundType);
            playGong();
        }

        function renderRoutine() {
            const daySelections = getReflectionsForDay(currentDayIndex);
            const visualization = visualizations[currentDayIndex % visualizations.length];
            const gratitude = gratitudes[currentDayIndex % gratitudes.length];

            document.getElementById('dayDisplay').textContent = days[currentDayIndex];

            const routineHTML = `
                <div class="step" id="step-1">
                    <div class="step-header">
                        <input type="checkbox" class="step-checkbox" id="checkbox-1" onchange="toggleStep(1)">
                        <div class="step-title">Silent Meditation</div>
                    </div>
                    <div class="step-content">
                        <div class="timer-controls">
                            <button class="timer-btn" onclick="startTimer(10)">10 min</button>
                            <button class="timer-btn" onclick="startTimer(20)">20 min</button>
                            <button class="timer-btn" onclick="startTimer(30)">30 min</button>
                            <button class="timer-btn" onclick="showCustomTimer()">Custom</button>
                        </div>
                        <div id="customTimerInput" style="display: none; margin-top: 16px;">
                            <input type="number" id="customMinutes" placeholder="Minutes" min="1" max="120" style="padding: 8px; border-radius: 8px; border: 1px solid #E5E0D8; width: 100px; margin-right: 8px;">
                            <button class="timer-btn" onclick="startCustomTimer()">Start</button>
                        </div>
                        <div id="timerDisplay" style="display: none; margin-top: 16px; text-align: center;">
                            <div style="font-size: 2.5em; font-weight: 600; color: #2D2D2D; margin-bottom: 12px;" id="timeRemaining">00:00</div>
                            <button class="timer-btn" onclick="stopTimer()" style="background: #B08580;">Stop</button>
                        </div>
                    </div>
                </div>

                <div class="step" id="step-2">
                    <div class="step-header">
                        <input type="checkbox" class="step-checkbox" id="checkbox-2" onchange="toggleStep(2)">
                        <div class="step-title">Reflections</div>
                    </div>
                    <div class="step-content">
                        <div class="reflection-sections">
                            <div class="reflection-section">
                                <button class="reflection-btn" onclick="toggleReflection('impermanence')">Impermanence</button>
                                <div id="impermanence" class="reflection-content" style="display: none;">
                                    ${daySelections.impermanence.map(r => `<div class="reflection-item">${r}</div>`).join('')}
                                </div>
                            </div>

                            <div class="reflection-section">
                                <button class="reflection-btn" onclick="toggleReflection('renunciation')">Renunciation</button>
                                <div id="renunciation" class="reflection-content" style="display: none;">
                                    ${daySelections.renunciation.map(r => `<div class="reflection-item">${r}</div>`).join('')}
                                </div>
                            </div>

                            <div class="reflection-section">
                                <button class="reflection-btn" onclick="toggleReflection('emptiness')">Emptiness</button>
                                <div id="emptiness" class="reflection-content" style="display: none;">
                                    ${daySelections.emptiness.map(r => `<div class="reflection-item">${r}</div>`).join('')}
                                </div>
                            </div>

                            <div class="reflection-section">
                                <button class="reflection-btn" onclick="toggleReflection('selfCompassion')">Self-Compassion</button>
                                <div id="selfCompassion" class="reflection-content" style="display: none;">
                                    ${daySelections.selfCompassion.map(r => `<div class="reflection-item">${r}</div>`).join('')}
                                </div>
                            </div>

                            <div class="reflection-section">
                                <button class="reflection-btn" onclick="toggleReflection('bodhicitta')">Bodhicitta</button>
                                <div id="bodhicitta" class="reflection-content" style="display: none;">
                                    ${daySelections.bodhicitta.map(r => `<div class="reflection-item">${r}</div>`).join('')}
                                </div>
                            </div>

                            <div class="reflection-section">
                                <button class="reflection-btn" onclick="toggleReflection('dedication')">Dedication & Aspiration</button>
                                <div id="dedication" class="reflection-content" style="display: none;">
                                    ${daySelections.dedication.map(r => `<div class="reflection-item">${r}</div>`).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="step" id="step-3">
                    <div class="step-header">
                        <input type="checkbox" class="step-checkbox" id="checkbox-3" onchange="toggleStep(3)">
                        <div class="step-title">Visualization</div>
                    </div>
                    <div class="step-content" id="visualization-content">
                    </div>
                </div>

                <div class="step" id="step-4">
                    <div class="step-header">
                        <input type="checkbox" class="step-checkbox" id="checkbox-4" onchange="toggleStep(4)">
                        <div class="step-title">Gratitude</div>
                    </div>
                    <div class="step-content" id="gratitude-content">
                    </div>
                </div>

                <div class="step" id="step-5">
                    <div class="step-header">
                        <input type="checkbox" class="step-checkbox" id="checkbox-5" onchange="toggleStep(5)">
                        <div class="step-title">Journaling</div>
                    </div>
                    <div class="step-content">
                        <p>Let your thoughts flow onto the page without judgment or editing.</p>
                    </div>
                </div>

                <div class="step" id="step-6">
                    <div class="step-header">
                        <input type="checkbox" class="step-checkbox" id="checkbox-6" onchange="toggleStep(6)">
                        <div class="step-title">Reading</div>
                    </div>
                    <div class="step-content">
                        <p>Read a few pages of something nourishing or inspiring.</p>
                    </div>
                </div>

                <div class="step" id="step-7">
                    <div class="step-header">
                        <input type="checkbox" class="step-checkbox" id="checkbox-7" onchange="toggleStep(7)">
                        <div class="step-title">Exercise</div>
                    </div>
                    <div class="step-content">
                        <p>Gentle movement, yoga, stretching, or walking.</p>
                    </div>
                </div>
            `;

            document.getElementById('routine').innerHTML = routineHTML;
            
            // Set HTML content for visualization and gratitude
            document.getElementById('visualization-content').innerHTML = visualization;
            document.getElementById('gratitude-content').innerHTML = gratitude;
            
            loadCheckboxStates();
        }

        function toggleStep(stepNumber) {
            const checkbox = document.getElementById(`checkbox-${stepNumber}`);
            const step = document.getElementById(`step-${stepNumber}`);
            
            if (checkbox.checked) {
                step.classList.add('completed');
            } else {
                step.classList.remove('completed');
            }
            
            saveCheckboxStates();
        }

        function saveCheckboxStates() {
            const today = new Date().toDateString();
            const states = {};
            
            for (let i = 1; i <= 7; i++) {
                const checkbox = document.getElementById(`checkbox-${i}`);
                if (checkbox) {
                    states[i] = checkbox.checked;
                }
            }
            
            localStorage.setItem(`miracle-morning-${today}`, JSON.stringify(states));
        }

        function loadCheckboxStates() {
            const today = new Date().toDateString();
            const savedStates = localStorage.getItem(`miracle-morning-${today}`);
            
            if (savedStates) {
                const states = JSON.parse(savedStates);
                
                for (let i = 1; i <= 7; i++) {
                    const checkbox = document.getElementById(`checkbox-${i}`);
                    const step = document.getElementById(`step-${i}`);
                    
                    if (checkbox && states[i]) {
                        checkbox.checked = true;
                        step.classList.add('completed');
                    }
                }
            }
        }

        function nextDay() {
            currentDayIndex = (currentDayIndex + 1) % 7;
            renderRoutine();
        }

        function previousDay() {
            currentDayIndex = (currentDayIndex - 1 + 7) % 7;
            renderRoutine();
        }

        // Initialize
        renderRoutine();
    </script>
</body>
</html>
